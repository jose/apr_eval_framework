--- src/com/google/javascript/jscomp/type/SemanticReverseAbstractInterpreter.java	2023-12-05 20:04:42.850056353 +0000
+++ src/com/google/javascript/jscomp/type/SemanticReverseAbstractInterpreter.java	2023-12-05 20:04:47.135325036 +0000
@@ -298,8 +298,8 @@
     if (merged != null) {
       return maybeRestrictTwoNames(
           blindScope,
-          left, leftIsRefineable, merged.typeA,
-          right, rightIsRefineable, merged.typeB);
+          left, leftType, leftIsRefineable ? merged.typeA : null,
+          right, rightType, rightIsRefineable ? merged.typeB : null);
     }
     return blindScope;
   }
@@ -345,8 +345,8 @@
       // creating new scope
       return maybeRestrictTwoNames(
           blindScope,
-          left, leftIsRefineable, restrictedLeftType,
-          right, rightIsRefineable, restrictedRightType);
+          left, leftType, leftIsRefineable ? restrictedLeftType : null,
+          right, rightType, rightIsRefineable ? restrictedRightType : null);
     }
     return blindScope;
   }
@@ -391,7 +391,7 @@
    */
   private FlowScope maybeRestrictName(
       FlowScope blindScope, Node node, JSType originalType, JSType restrictedType) {
-    if (restrictedType != null && !restrictedType.equals(originalType)) {
+    if (restrictedType != null && restrictedType != originalType) {
       FlowScope informed = blindScope.createChildFlowScope();
       declareNameInScope(informed, node, restrictedType);
       return informed;
@@ -404,12 +404,12 @@
    */
   private FlowScope maybeRestrictTwoNames(
       FlowScope blindScope,
-      Node left, boolean leftIsRefineable, JSType restrictedLeftType,
-      Node right, boolean rightIsRefineable, JSType restrictedRightType) {
+      Node left, JSType originalLeftType, JSType restrictedLeftType,
+      Node right, JSType originalRightType, JSType restrictedRightType) {
     boolean shouldRefineLeft =
-        leftIsRefineable && restrictedLeftType != null;
+        restrictedLeftType != null && restrictedLeftType != originalLeftType;
     boolean shouldRefineRight =
-        rightIsRefineable && restrictedRightType != null;
+        restrictedRightType != null && restrictedRightType != originalRightType;
     if (shouldRefineLeft || shouldRefineRight) {
       FlowScope informed = blindScope.createChildFlowScope();
       if (shouldRefineLeft) {
@@ -427,11 +427,9 @@
       boolean outcome) {
     JSType type = getTypeIfRefinable(name, blindScope);
     if (type != null) {
-      JSType restrictedType =
-          type.getRestrictedTypeGivenToBooleanOutcome(outcome);
-      FlowScope informed = blindScope.createChildFlowScope();
-      declareNameInScope(informed, name, restrictedType);
-      return informed;
+      return maybeRestrictName(
+          blindScope, name, type,
+          type.getRestrictedTypeGivenToBooleanOutcome(outcome));
     }
     return blindScope;
   }
--- src/com/google/javascript/rhino/jstype/JSType.java	2023-12-05 20:04:42.850761286 +0000
+++ src/com/google/javascript/rhino/jstype/JSType.java	2023-12-05 20:04:47.135756902 +0000
@@ -880,6 +880,9 @@
    * method of types to get the restricted type.
    */
   public JSType getRestrictedTypeGivenToBooleanOutcome(boolean outcome) {
+    if (outcome && this == getNativeType(JSTypeNative.UNKNOWN_TYPE)) {
+      return getNativeType(JSTypeNative.CHECKED_UNKNOWN_TYPE);
+    }
 
     BooleanLiteralSet literals = getPossibleToBooleanOutcomes();
     if (literals.contains(outcome)) {
